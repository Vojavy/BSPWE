# ============================================================================
#  Виртуальный хост для основного сайта хостинг-центра
#  Обслуживает домен hosting.mojefirma.cz и его алиасы, отдавая фронтенд и бэкенд.
# ============================================================================
<VirtualHost *:80>
    # Определяем точное доменное имя, по которому будет работать этот хост.
    ServerName hosting.mojefirma.cz
    
    # Дополнительное имя, по которому также можно обращаться.
    ServerAlias www.hosting.mojefirma.cz

    # Включаем сохранение оригинального заголовка Host при проксировании.
    ProxyPreserveHost On

    # ============================================================================
    #  Проксирование запросов к бэкенду
    #  Все запросы, начинающиеся с /api, будут переданы на локальный сервер, где
    #  работает PHP-бэкенд (например, на порту 5000).
    # ============================================================================
    ProxyPass /api http://localhost:5000/api
    ProxyPassReverse /api http://localhost:5000/api

    # ============================================================================
    #  Проксирование запросов к фронтенду (Next.js)
    #  Все остальные запросы будут перенаправляться на Next.js-сервер (например, порт 3000).
    # ============================================================================
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/

    # Логи для данного виртуального хоста.
    ErrorLog ${APACHE_LOG_DIR}/hosting_error.log
    CustomLog ${APACHE_LOG_DIR}/hosting_access.log combined
</VirtualHost>

# ============================================================================
#  Виртуальный хост для пользовательских сайтов (динамические поддомены)
#  Обслуживает все поддомены вида *.mojefirma.cz (например, gaydomen.mojefirma.cz)
# ============================================================================
<VirtualHost *:80>
    # Этот блок обрабатывает все запросы для поддоменов, кроме hosting.mojefirma.cz.
    ServerAlias *.mojefirma.cz

    # Динамически подставляем первую часть поддомена в путь.
    # Например, для gaydomen.mojefirma.cz Apache ищет файлы в /var/www/users/gaydomen.
    VirtualDocumentRoot /var/www/users/%1

    # Логи для сайтов пользователей.
    ErrorLog ${APACHE_LOG_DIR}/user_sites_error.log
    CustomLog ${APACHE_LOG_DIR}/user_sites_access.log combined
</VirtualHost>

ServerName localhost